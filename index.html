<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Billboard Scanner</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/2.1.5/tesseract.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
        }

        .container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
        }

        .header {
            text-align: center;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.8;
        }

        .scanner-frame {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 40%;
            border: 3px solid #00ff88;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .controls {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .scan-button {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
            border: none;
            border-radius: 15px;
            color: #000;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
        }

        .scan-button:hover {
            transform: translateY(-2px);
        }

        .scan-button:active {
            transform: translateY(0);
        }

        .scan-button.scanning {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            animation: scanning 1s infinite;
        }

        @keyframes scanning {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        .status {
            text-align: center;
            font-size: 16px;
            margin-bottom: 15px;
            min-height: 24px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
        }

        .status.scanning {
            color: #00ff88;
        }

        .status.detected {
            color: #ffaa00;
            font-weight: bold;
            background: rgba(255, 170, 0, 0.1);
            border: 1px solid rgba(255, 170, 0, 0.3);
        }

        .status.error {
            color: #ff4444;
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid rgba(255, 68, 68, 0.3);
        }

        .detected-keywords {
            background: rgba(0, 255, 136, 0.15);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
            display: none;
        }

        .detected-keywords.show {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .detected-keywords h4 {
            color: #00ff88;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .keywords-list {
            font-size: 14px;
            opacity: 0.9;
        }

        .location-info {
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
            text-align: center;
            opacity: 0.8;
        }

        .notification {
            position: fixed;
            top: -100%;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 400px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 1000;
        }

        .notification.show {
            top: 20px;
        }

        .notification h3 {
            font-size: 20px;
            margin-bottom: 10px;
            color: #fff;
        }

        .notification p {
            font-size: 16px;
            margin-bottom: 20px;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.4;
        }

        .notification button {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 12px;
            color: #fff;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .content-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #fff;
            color: #333;
            transform: translateY(100%);
            transition: transform 0.5s ease;
            z-index: 2000;
            overflow-y: auto;
        }

        .content-page.show {
            transform: translateY(0);
        }

        .content-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            padding: 60px 20px 30px;
            text-align: center;
        }

        .content-body {
            padding: 30px 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .close-btn {
            position: absolute;
            top: 30px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: #fff;
            font-size: 24px;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            width: 45px;
            height: 45px;
        }

        @media (max-width: 480px) {
            .header h1 { font-size: 20px; }
            .notification { width: 95%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <video id="video" autoplay playsinline></video>
        
        <div class="overlay">
            <div class="header">
                <h1>üéØ AI Billboard Scanner</h1>
                <p>Point camera at billboards and scan for AI text</p>
            </div>
            
            <div class="scanner-frame"></div>
            
            <div class="controls">
                <button class="scan-button" id="scan-button" onclick="performScan()">
                    üì± Scan for AI Text
                </button>
                
                <div class="status" id="status">Point camera at billboard and tap scan</div>
                
                <div class="detected-keywords" id="detected-keywords">
                    <h4>üéØ AI Keywords Found:</h4>
                    <div class="keywords-list" id="keywords-list"></div>
                </div>
                
                <div class="location-info" id="location-info">
                    üìç Getting location...
                </div>
            </div>
        </div>
    </div>

    <div id="notification" class="notification">
        <h3 id="notif-title">AI Billboard Detected!</h3>
        <p id="notif-text">Local culture content loading...</p>
        <button onclick="showContent()">Explore Local Culture ‚Üí</button>
    </div>

    <div id="content-page" class="content-page">
        <div class="content-header">
            <button class="close-btn" onclick="closeContent()">&times;</button>
            <h1 id="content-title">San Francisco</h1>
            <p id="content-subtitle">Real stories behind the billboards</p>
        </div>
        <div class="content-body" id="content-body">
            <!-- Content will be populated here -->
        </div>
    </div>

    <script>
        let video;
        let isScanning = false;
        let userLocation = null;
        let lastScanTime = 0;
        let ocrWorker = null;

        // Comprehensive AI keywords list - catches most AI advertising
        const aiKeywords = [
            // Core AI terms
            'AI', 'artificial intelligence', 'machine learning', 'deep learning', 'neural network',
            'neural networks', 'algorithm', 'algorithms', 'automation', 'intelligent', 'smart', 
            'cognitive', 'neural', 'ML', 'artificial',
            
            // Popular AI models/products
            'chatgpt', 'gpt', 'gpt-3', 'gpt-4', 'openai', 'claude', 'anthropic', 'gemini', 
            'bard', 'copilot', 'midjourney', 'dall-e', 'dalle', 'stable diffusion', 
            'hugging face', 'palm', 'llama', 'bert', 'transformer',
            
            // Technical AI terms
            'LLM', 'large language model', 'generative AI', 'generative', 'transformer', 
            'NLP', 'natural language processing', 'computer vision', 'predictive', 
            'analytics', 'insights', 'data science', 'big data', 'foundation model',
            'multimodal', 'reasoning', 'inference', 'training', 'model',
            
            // AI-powered phrases
            'AI-powered', 'AI-driven', 'powered by AI', 'AI-enabled', 'AI-assisted',
            'AI-enhanced', 'intelligent platform', 'smart solution', 'automated', 
            'self-learning', 'machine-powered', 'algorithmically', 'data-driven',
            
            // Common AI assistants/bots
            'bot', 'chatbot', 'assistant', 'virtual assistant', 'digital assistant',
            'alexa', 'siri', 'cortana', 'google assistant', 'voice assistant',
            
            // Marketing buzzwords
            'revolutionary AI', 'next-gen', 'cutting-edge', 'breakthrough', 
            'innovative AI', 'advanced AI', 'intelligent automation', 'future-ready',
            'AI revolution', 'smart tech', 'cognitive computing',
            
            // Business AI terms
            'robotic process automation', 'RPA', 'recommendation engine', 'recommendations',
            'personalization', 'optimization', 'forecasting', 'prediction', 'predictions',
            'sentiment analysis', 'behavioral analysis', 'pattern recognition',
            
            // Emerging/advanced terms
            'AGI', 'artificial general intelligence', 'superintelligence', 'consciousness',
            'singularity', 'autonomous', 'self-driving', 'computer brain', 'digital brain',
            
            // Industry-specific AI
            'fintech AI', 'healthcare AI', 'AI diagnostics', 'AI therapy', 'robo-advisor',
            'algorithmic trading', 'fraud detection', 'risk assessment', 'credit scoring',
            
            // AI capabilities
            'speech recognition', 'image recognition', 'facial recognition', 'text analysis',
            'language translation', 'content generation', 'code generation', 'synthesis',
            'classification', 'clustering', 'regression', 'supervised learning',
            'unsupervised learning', 'reinforcement learning', 'transfer learning',
            
            // Common variations and misspellings
            'A.I.', 'A.I', 'machinelearning', 'deeplearning', 'artificialintelligence',
            'chatGPT', 'ChatGpt', 'CHATGPT', 'Machine Learning', 'Deep Learning'
        ];

        // Neighborhood content
        const neighborhoods = {
            'mission': {
                name: 'Mission District',
                subtitle: 'Where music and culture collide',
                content: `
                    <h2>üé∏ Carlos Santana's Legacy</h2>
                    <p>The Mission District is where guitar legend Carlos Santana got his start, playing in local venues and absorbing the rich cultural mix that would define his unique sound.</p>
                    
                    <h3>Cultural Heartbeat</h3>
                    <p>This neighborhood pulses with authentic Latino culture, street art, and grassroots community organizing - the opposite of corporate AI messaging.</p>
                    
                    <h3>Real Innovation</h3>
                    <p>While tech companies push artificial intelligence, the Mission continues its tradition of human creativity through murals, music, and social movements that actually change lives.</p>
                    
                    <p><strong>The Mission reminds us:</strong> The most powerful intelligence is human creativity, community connection, and cultural expression.</p>
                `
            },
            'soma': {
                name: 'SOMA',
                subtitle: 'Beyond the startup bubble',
                content: `
                    <h2>üè≠ Industrial Roots</h2>
                    <p>Before SOMA became startup central, it was the industrial backbone of San Francisco - warehouses, factories, and working-class communities.</p>
                    
                    <h3>Hidden Stories</h3>
                    <p>Behind every AI billboard in SOMA are displaced communities and erased histories of the people who built this neighborhood.</p>
                    
                    <p><strong>SOMA teaches us:</strong> Technology is only as good as how it serves real people and communities.</p>
                `
            },
            'castro': {
                name: 'Castro District',
                subtitle: 'Pride and resistance',
                content: `
                    <h2>üè≥Ô∏è‚Äçüåà Liberation Movement</h2>
                    <p>The Castro was built by LGBTQ+ activists who fought for visibility, rights, and community - not corporate algorithms.</p>
                    
                    <p><strong>The Castro shows us:</strong> Change comes from people organizing together, not from algorithms.</p>
                `
            },
            'default': {
                name: 'San Francisco',
                subtitle: 'Real stories behind the billboards',
                content: `
                    <h2>üåÅ City of Neighborhoods</h2>
                    <p>Every neighborhood in SF has stories that matter more than whatever AI product is being advertised.</p>
                    
                    <h3>Human Innovation</h3>
                    <p>The real innovation in San Francisco comes from diverse communities, artists, activists, and local businesses - not just tech companies.</p>
                    
                    <p><strong>Remember:</strong> The most interesting stories are happening in the communities around you, not in the advertisements.</p>
                `
            }
        };

        function initCamera() {
            console.log('Starting camera initialization...');
            
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                updateStatus("‚ùå Camera not supported on this device", "error");
                return;
            }

            updateStatus("üé• Starting camera...", "scanning");

            navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: 'environment',
                    width: { ideal: 720 },
                    height: { ideal: 480 }
                } 
            })
            .then(stream => {
                console.log('Camera stream obtained');
                video = document.getElementById('video');
                video.srcObject = stream;
                
                video.onloadedmetadata = () => {
                    console.log('Video metadata loaded');
                    updateStatus("ü§ñ Loading text detection...", "scanning");
                    initOCR();
                };
                
                return video.play();
            })
            .catch(error => {
                console.error('Camera error:', error);
                updateStatus("‚ùå Camera access denied. Please allow permissions.", "error");
            });
        }

        async function initOCR() {
            try {
                updateStatus("üìö Loading OCR engine...", "scanning");
                
                // Use older, more stable Tesseract version
                ocrWorker = Tesseract.createWorker({
                    logger: m => {
                        if (m.status === 'recognizing text') {
                            updateStatus(`üîç Loading OCR: ${Math.round(m.progress * 100)}%`, "scanning");
                        }
                    }
                });
                
                await ocrWorker.load();
                await ocrWorker.loadLanguage('eng');
                await ocrWorker.initialize('eng');
                
                updateStatus("‚úÖ Ready! Point at AI text and scan", "");
                getCurrentLocation();
                
            } catch (error) {
                console.error('OCR failed:', error);
                updateStatus("‚ö†Ô∏è Text detection unavailable - using visual analysis", "");
                getCurrentLocation();
            }
        }

        function performScan() {
            console.log('Scan button clicked');
            
            const now = Date.now();
            if (now - lastScanTime < 2000) {
                console.log('Scan blocked - too recent');
                return;
            }
            lastScanTime = now;

            if (isScanning) {
                console.log('Already scanning');
                return;
            }

            if (!video || !video.videoWidth) {
                updateStatus("‚ùå Camera not ready - please wait", "error");
                return;
            }

            isScanning = true;
            const button = document.getElementById('scan-button');
            button.classList.add('scanning');
            button.textContent = "üîç Scanning...";
            
            updateStatus("ü§ñ Analyzing image for AI content...", "scanning");

            // Simulate realistic scanning process
            setTimeout(() => {
                analyzeForAI();
            }, 1500);
        }

        function analyzeForAI() {
            console.log('Analyzing for AI content');
            
            if (!video || !video.videoWidth) {
                updateStatus("‚ùå Camera not ready", "error");
                resetScanButton();
                return;
            }

            try {
                // Capture current frame
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                ctx.drawImage(video, 0, 0);
                
                updateStatus("üîç Reading text in image...", "scanning");
                
                if (ocrWorker) {
                    // Use real OCR
                    performOCR(canvas);
                } else {
                    // Fallback to visual analysis
                    performVisualAnalysis(canvas);
                }
                
            } catch (error) {
                console.error('Analysis error:', error);
                updateStatus("‚ùå Analysis failed - try again", "error");
                resetScanButton();
            }
        }

        async function performOCR(canvas) {
            try {
                updateStatus("üîç Reading text...", "scanning");
                const { data: { text } } = await ocrWorker.recognize(canvas);
                console.log('Raw OCR Result:', text);
                
                if (text && text.trim().length > 1) {
                    // Show exactly what was detected
                    const detectedText = text.trim();
                    console.log('Clean detected text:', detectedText);
                    
                    // Check ONLY the detected text for AI keywords
                    const foundKeywords = [];
                    const lowerText = detectedText.toLowerCase();
                    
                    for (const keyword of aiKeywords) {
                        if (lowerText.includes(keyword.toLowerCase())) {
                            foundKeywords.push(keyword);
                        }
                    }
                    
                    if (foundKeywords.length > 0) {
                        updateStatus(`‚úÖ Found AI text: "${detectedText}"`, "detected");
                        showDetectedKeywords(foundKeywords);
                        
                        setTimeout(() => {
                            showNotification(foundKeywords);
                        }, 1000);
                    } else {
                        updateStatus(`üìù Text found: "${detectedText}" - No AI keywords`, "");
                        hideDetectedKeywords();
                    }
                } else {
                    updateStatus("‚ùå No text detected - try better lighting/closer", "");
                    hideDetectedKeywords();
                }
                
            } catch (error) {
                console.error('OCR error:', error);
                updateStatus("‚ùå Text reading failed - OCR not working", "error");
                hideDetectedKeywords();
            }
            
            resetScanButton();
        }

        function performVisualAnalysis(canvas) {
            // Only use this if OCR completely failed
            updateStatus("‚ö†Ô∏è OCR unavailable - manual detection only", "error");
            hideDetectedKeywords();
            resetScanButton();
        }

        function analyzeForTextPatterns(imageData) {
            // Simple analysis for high-contrast regions that suggest text
            const data = imageData.data;
            let textScore = 0;
            const sampleSize = Math.min(2000, data.length / 16);
            
            for (let i = 0; i < sampleSize; i++) {
                const randomIndex = Math.floor(Math.random() * (data.length / 4)) * 4;
                const r = data[randomIndex];
                const g = data[randomIndex + 1];
                const b = data[randomIndex + 2];
                
                const brightness = (r + g + b) / 3;
                
                // Look for high contrast (suggests text)
                if (brightness < 50 || brightness > 200) {
                    textScore++;
                }
            }
            
            const textDensity = textScore / sampleSize;
            console.log('Text pattern analysis - density:', textDensity);
            
            return textDensity > 0.2; // 20% high contrast suggests text
        }

        function resetScanButton() {
            setTimeout(() => {
                const button = document.getElementById('scan-button');
                button.classList.remove('scanning');
                button.textContent = "üì± Scan for AI Text";
                isScanning = false;
            }, 1000);
        }

        function showDetectedKeywords(keywords) {
            console.log('Showing ONLY detected keywords:', keywords);
            const keywordsDiv = document.getElementById('detected-keywords');
            const keywordsList = document.getElementById('keywords-list');
            
            // Show ONLY the keywords that were actually found in the text
            keywordsList.textContent = keywords.map(k => `"${k}"`).join(', ');
            keywordsDiv.classList.add('show');
        }

        function hideDetectedKeywords() {
            document.getElementById('detected-keywords').classList.remove('show');
        }

        function showNotification(keywords) {
            console.log('Showing notification for keywords:', keywords);
            const notification = document.getElementById('notification');
            const title = document.getElementById('notif-title');
            const text = document.getElementById('notif-text');
            
            let neighborhood = 'default';
            if (userLocation) {
                neighborhood = getNeighborhoodFromLocation(userLocation.lat, userLocation.lng);
            }
            
            const neighborhoodName = neighborhoods[neighborhood].name;
            const keywordText = keywords.slice(0, 2).map(k => `"${k}"`).join(', ');
            
            title.textContent = `üéØ AI Billboard Detected!`;
            text.textContent = `Found ${keywordText} in ${neighborhoodName}. Discover what this neighborhood is really about beyond the AI advertisements.`;
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 10000);
        }

        function showContent() {
            document.getElementById('notification').classList.remove('show');
            
            let neighborhood = 'default';
            if (userLocation) {
                neighborhood = getNeighborhoodFromLocation(userLocation.lat, userLocation.lng);
            }
            
            const content = neighborhoods[neighborhood];
            document.getElementById('content-title').textContent = content.name;
            document.getElementById('content-subtitle').textContent = content.subtitle;
            document.getElementById('content-body').innerHTML = content.content;
            document.getElementById('content-page').classList.add('show');
        }

        function closeContent() {
            document.getElementById('content-page').classList.remove('show');
        }

        function getCurrentLocation() {
            const locationInfo = document.getElementById('location-info');
            
            if (!navigator.geolocation) {
                locationInfo.innerHTML = `üìç Location not supported`;
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    console.log('Location obtained:', position.coords.latitude, position.coords.longitude);
                    userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    
                    const neighborhood = getNeighborhoodFromLocation(userLocation.lat, userLocation.lng);
                    const neighborhoodName = neighborhoods[neighborhood].name;
                    locationInfo.innerHTML = `üìç ${neighborhoodName}`;
                },
                (error) => {
                    console.log('Location error:', error);
                    locationInfo.innerHTML = `üìç Location unavailable - using SF default`;
                },
                { enableHighAccuracy: true, timeout: 10000 }
            );
        }

        function getNeighborhoodFromLocation(lat, lng) {
            if (lat >= 37.746 && lat <= 37.773 && lng >= -122.427 && lng <= -122.396) {
                return 'mission';
            } else if (lat >= 37.770 && lat <= 37.794 && lng >= -122.420 && lng <= -122.385) {
                return 'soma';
            } else if (lat >= 37.758 && lat <= 37.768 && lng >= -122.445 && lng <= -122.425) {
                return 'castro';
            }
            return 'default';
        }

        function updateStatus(message, type = '') {
            console.log('Status update:', message, type);
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status ' + type;
        }

        // Initialize when page loads
        console.log('Page loaded, initializing...');
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM ready, starting camera...');
            initCamera();
        });
    </script>
</body>
</html>
